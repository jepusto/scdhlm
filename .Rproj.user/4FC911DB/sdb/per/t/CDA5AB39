{
    "contents" : "\n##------------------------------------------------------------------------\n## block-diagonal matrix addition, multiplication, and trace functions \n##------------------------------------------------------------------------\n\n# turn block-diagonal into regular matrix\n\nunblock <- function(A, block=NULL) {\n  if (is.null(block)) block <- rep(names(A), times = sapply(A, function(x) dim(x)[1]))\n  n <- length(block)\n  mat <- matrix(0, n, n)\n  for (i in unique(block)) {\n    index <- i == block\n    mat[index,index] <- A[[i]]\n  }\n  return(mat)\n}\n\n\n# sum of two conformable block-diagonal matrices\n\nsum_blockblock <- function(A, B)\n  mapply(function(a,b) a + b, a = A, b = B, SIMPLIFY = FALSE)\n\n\n# generic matrix minus block-diagonal\n\nmatrix_minus_block <- function(A, B, block=NULL) {\n  if (is.null(block)) block <- rep(names(B), times = sapply(B, function(x) dim(x)[1]))\n  \n  mat <- A\n  for (i in unique(block)) {\n    index <- i == block\n    mat[index,index] <- mat[index, index] - B[[i]]\n  }\n  return(mat)\n}\n\n\n# block-diagonal minus generic matrix\n\nblock_minus_matrix <- function(A, B, block=NULL) {\n  if (is.null(block))\n    block <- rep(names(A), times = sapply(A, function(x) dim(x)[1]))\n  \n  mat <- -B\n  for (i in unique(block)) {\n    index <- i == block\n    mat[index,index] <- mat[index, index] + A[[i]]\n  }\n  return(mat)\n}\n\n\n# product of two conformable block-diagonal matrices\n\nprod_blockblock <- function(A, B)\n  mapply(function(a, b) a %*% b, a = A, b = B, SIMPLIFY = FALSE)\n\n\n\n# product of a block-diagonal matrix and a generic matrix\n\nprod_blockmatrix <- function(A, B, block = NULL) {\n  \n  if (is.null(names(A))) names(A) <- 1:length(A)\n  A_names <- names(A)\n  \n  if (is.null(block)) block <- rep(A_names, times = sapply(A, function(x) dim(x)[1]))\n  \n  C <- matrix(0, length(block), dim(B)[2])\n  \n  for (b in A_names) {\n    ind <- block == b\n    C[ind, ] <- A[[b]] %*% B[ind,]\n  }\n  return(C)\n}  \n\n\n# product of a generic matrix and a block-diagonal matrix\n\nprod_matrixblock <- function(A, B, block = NULL) {\n  \n  if (is.null(names(B))) names(B) <- 1:length(B)\n  B_names <- names(B)\n  \n  if (is.null(block)) block <- rep(B_names, times = sapply(B, function(x) dim(x)[2]))\n  \n  C <- matrix(0, dim(A)[1], length(block))\n  \n  for (b in B_names) {\n    ind <- block == b\n    C[,ind] <- A[,ind] %*% B[[b]]\n  }\n  return(C)\n}  \n\n\n\n# trace of the product of two generic matrices\n\nproduct_trace <- function(A,B) sum(as.vector(t(A)) * as.vector(B))\n\n\n# trace of the product of two conformable block-diagonal matrices\n\nproduct_trace_blockblock <- function(A, B) \n  mapply(function(a, b) product_trace(a,b), a = A, b = B)\n\n\n\n# Hedges G correction\n\nJ <- function(x) 1 - 3 / (4 * x - 1)\n",
    "created" : 1386972632017.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "497879639",
    "id" : "CDA5AB39",
    "lastKnownWriteTime" : 1386970301,
    "path" : "~/My Box Files/Single-case research/scdhlm/R/matrix-functions.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}